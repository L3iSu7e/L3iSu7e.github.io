

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="L3iSu7e">
  <meta name="keywords" content="">
  
    <meta name="description" content="2023年春秋杯冬季赛 Reverse 题解">
<meta property="og:type" content="article">
<meta property="og:title" content="2023年春秋杯冬季赛 RE Writeup">
<meta property="og:url" content="https://l3isu7e.github.io/2024/01/27/ichunqiu2023/index.html">
<meta property="og:site_name" content="L3iSu7e&#39;s Blog">
<meta property="og:description" content="2023年春秋杯冬季赛 Reverse 题解">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://l3isu7e.github.io/img/ichunqiu2023/index.jpg">
<meta property="article:published_time" content="2024-01-26T16:24:35.692Z">
<meta property="article:modified_time" content="2024-01-26T16:43:38.085Z">
<meta property="article:author" content="L3iSu7e">
<meta property="article:tag" content="Reverse">
<meta property="article:tag" content="CTF">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://l3isu7e.github.io/img/ichunqiu2023/index.jpg">
  
  
  
  <title>2023年春秋杯冬季赛 RE Writeup - L3iSu7e&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"l3isu7e.github.io","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":"f9b9e0e66f451ec58213e3ec9c0a191f","google":"G-FJM9933EKV","tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"ke74FnGuhACfD2pAnPxzatom-gzGzoHsz","app_key":"9gaOptPOUXQ0hYBjONJB0QkJ","server_url":"https://ke74fngu.lc-cn-n1-shared.com","path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  
    <!-- Baidu Analytics -->
    <script async>
      if (!Fluid.ctx.dnt) {
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?f9b9e0e66f451ec58213e3ec9c0a191f";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
      }
    </script>
  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', '');
        });
      }
    </script>
  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 7.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>LeiSu7e</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/ichunqiu2023/bg.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="2023年春秋杯冬季赛 RE Writeup"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-01-27 00:24" pubdate>
          2024年1月27日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          3.9k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          33 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">2023年春秋杯冬季赛 RE Writeup</h1>
            
              <p id="updated-time" class="note note-info" style="">
                
                  
                    本文最后更新于 2024年1月27日 凌晨
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <p>2023年春秋杯冬季赛 Reverse 题解</p>
<span id="more"></span>

<h1 id="UPX2023"><a href="#UPX2023" class="headerlink" title="UPX2023"></a>UPX2023</h1><h2 id="0x0-脱壳"><a href="#0x0-脱壳" class="headerlink" title="0x0 脱壳"></a>0x0 脱壳</h2><h3 id="工具一键脱壳"><a href="#工具一键脱壳" class="headerlink" title="工具一键脱壳"></a>工具一键脱壳</h3><p><img src="/./img/ichunqiu2023/a2316e089ace79e438fdb65ae3e894dfa2afdf1b.png" srcset="/img/loading.gif" lazyload><br>带有UPX壳，直接用工具脱会报错，打开010Editor，将小写的upx改为大写的upx即可<br><img src="/./img/ichunqiu2023/779988cc922dc1c18eb3eb3f22a657a113a3e8d0.png" srcset="/img/loading.gif" lazyload><br>修改之后，就可以一键脱壳了</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"> ⚡Administrator ❯❯ upx.exe -d .\upx2023fix.exe<br>                       Ultimate Packer for eXecutables<br>                          Copyright (C) 1996 - 2024<br>UPX 4.2.2       Markus Oberhumer, Laszlo Molnar &amp; John Reiser    Jan 3rd 2024<br><br>        File size         Ratio      Format      Name<br>   --------------------   ------   -----------   -----------<br>   1859146 &lt;-   1177162   63.32%    win64/pe     upx2023fix.exe<br><br>Unpacked 1 file.<br></code></pre></td></tr></table></figure>

<h3 id="手动脱壳"><a href="#手动脱壳" class="headerlink" title="手动脱壳"></a>手动脱壳</h3><p>自己做的时候没有注意到大小写的问题，也就借此机会记录一下详细手脱的过程<br>使用的软件：x64dbg及其自带插件 Scylla<br>参考链接：<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/99750">https://www.anquanke.com/post/id/99750</a></p>
<p>首先使用ida找到大跳转<br><img src="/./img/ichunqiu2023/f6274e3b1c728dcd7d5c20f11fcb79700fe9cca1.png" srcset="/img/loading.gif" lazyload><br><img src="/./img/ichunqiu2023/ff2723d730649725114e58140aa8772c9c53ebcf.png" srcset="/img/loading.gif" lazyload></p>
<p>在x64dbg中找到这个jmp直接，跟进去<br><img src="/./img/ichunqiu2023/1516cdae281dbf18e35d16850730a11c0f92baba.png" srcset="/img/loading.gif" lazyload><br>找到OEP<br><img src="/./img/ichunqiu2023/86037aa2b3c747f1b7b08b92332f31c57387f558.png" srcset="/img/loading.gif" lazyload><br>选择插件 Scylla dump另存为<br><img src="/./img/ichunqiu2023/d4905a8ce27919a97a8bd81469307286d01819b5.png" srcset="/img/loading.gif" lazyload><br>dump完成后修复IAT表，首先搜索IAT表<br><img src="/./img/ichunqiu2023/af26fec7fb78e095fc05dae3a97ac7afb3e5dec1.png" srcset="/img/loading.gif" lazyload> Get<br>Imports<br><img src="/./img/ichunqiu2023/910fb6898ba1133e6478c6b6857618d68452bc76.png" srcset="/img/loading.gif" lazyload><br>修复Dump出来的文件<br><img src="/./img/ichunqiu2023/188985ca70c2dce53105fa156c80b950b4ff3e55.png" srcset="/img/loading.gif" lazyload><br>出现下面的情况表示修复成功<br><img src="/./img/ichunqiu2023/2e791e1ed573e2338eafc6a50bbeeb3e8a075d61.png" srcset="/img/loading.gif" lazyload><br>我们可以直接运行试试</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">❯ .\upx2023_dump_SCY.exe<br>input your flag（用flag&#123;&#125;包裹）: aaaaaaaaaaaaaaaaaaaa<br>len error<br></code></pre></td></tr></table></figure>

<p>可以运行，脱壳成功</p>
<blockquote>
<p>但是电脑重启之后好像就不行 了…<br>并且对照工具脱壳后的结果，差异有点大，主要是在符号上</p>
</blockquote>
<h2 id="0x1-分析"><a href="#0x1-分析" class="headerlink" title="0x1 分析"></a>0x1 分析</h2><p>main函数的逻辑比较清晰</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> __fastcall <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  std::ostream *v3; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> *tb; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> cmpData[<span class="hljs-number">44</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-60h] BYREF</span><br>  <span class="hljs-type">char</span> input[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+D0h] [rbp+50h] BYREF</span><br>  <span class="hljs-type">char</span> v8[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+E0h] [rbp+60h] BYREF</span><br>  <span class="hljs-type">char</span> v9[<span class="hljs-number">20</span>]; <span class="hljs-comment">// [rsp+F0h] [rbp+70h] BYREF</span><br>  <span class="hljs-type">int</span> ta; <span class="hljs-comment">// [rsp+104h] [rbp+84h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> Seed; <span class="hljs-comment">// [rsp+108h] [rbp+88h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+10Ch] [rbp+8Ch]</span><br><br>  _main(argc, argv, envp);<br>  Seed = <span class="hljs-built_in">time</span>(<span class="hljs-number">0</span>i64);<br>  <span class="hljs-built_in">srand</span>(Seed);<br>  std::string::<span class="hljs-built_in">string</span>((std::string *)input);<br>  std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;((std::ostream *)&amp;std::cout, Str);<br>  std::<span class="hljs-keyword">operator</span>&gt;&gt;&lt;<span class="hljs-type">char</span>&gt;((std::istream *)&amp;std::cin, (std::string *)input);<br>  std::string::<span class="hljs-built_in">string</span>((std::string *)v9, (<span class="hljs-type">const</span> std::string *)input);<br>  <span class="hljs-built_in">change</span>(v8, v9);<br>  std::string::<span class="hljs-keyword">operator</span>=(input, v8);<br>  std::string::~<span class="hljs-built_in">string</span>((std::string *)v8);<br>  std::string::~<span class="hljs-built_in">string</span>((std::string *)v9);<br>  <span class="hljs-keyword">if</span> ( std::string::<span class="hljs-built_in">length</span>((std::string *)input) != <span class="hljs-number">42</span> )<span class="hljs-comment">// 判断长度</span><br>  &#123;<br>    v3 = (std::ostream *)std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;((std::ostream *)&amp;std::cout, <span class="hljs-string">&quot;len error&quot;</span>);<br>    std::endl&lt;<span class="hljs-type">char</span>,std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(v3);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>  &#125;<br>  <span class="hljs-built_in">qmemcpy</span>(cmpData, &amp;::cmpData, <span class="hljs-number">0xA8</span>ui64);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">41</span>; ++i )<br>  &#123;<br>    ta = <span class="hljs-built_in">rand</span>() % <span class="hljs-number">255</span>;<br>    tb = (<span class="hljs-type">char</span> *)std::string::<span class="hljs-keyword">operator</span>[](input, i);<br>    <span class="hljs-keyword">if</span> ( (ta ^ *tb) != cmpData[i] )<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>  &#125;<br>  std::string::~<span class="hljs-built_in">string</span>((std::string *)input);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>大概流程：输入经过打乱顺序后-&gt;判断长度是否为42-&gt;以当前的时间为种子生成随机数，使用该随机数异或打乱后的flag-&gt; 进行对比</p>
<p>打乱顺序可以通过调试得到固定的次序</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">input: ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnop<br>en: AEIMQUYcgkoBDFHJLNPRTVXZbdfhjlnpCGKOSWaeim<br></code></pre></td></tr></table></figure>

<p>根据上述关系可进行还原</p>
<h2 id="0x2-求解"><a href="#0x2-求解" class="headerlink" title="0x2 求解"></a>0x2 求解</h2><p>分析的重点是对随机数的处理，首先我们通过提示知道flag的格式是<code>flag&#123;xxxxx&#125;</code>，那么我们可以通过异或还原出六个随机数，并且通过打乱顺序后字符串确定其索引</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python">oStr = <span class="hljs-string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnop&#x27;</span><br>cStr = <span class="hljs-string">&#x27;AEIMQUYcgkoBDFHJLNPRTVXZbdfhjlnpCGKOSWaeim&#x27;</span><br><br>order = [oStr.index(cStr[i]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(cStr))]<br><br>demoStr = <span class="hljs-string">&#x27;flag&#123;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#125;&#x27;</span><br>enStr = <span class="hljs-string">&#x27;&#x27;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(demoStr)):<br>    enStr += demoStr[order[i]]<br><span class="hljs-built_in">print</span>(enStr)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;enStr.index(<span class="hljs-string">&#x27;f&#x27;</span>)&#125;</span> -&gt; <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(cmpData[enStr.index(<span class="hljs-string">&#x27;f&#x27;</span>)] ^ <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;f&#x27;</span>))&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;enStr.index(<span class="hljs-string">&#x27;l&#x27;</span>)&#125;</span> -&gt; <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(cmpData[enStr.index(<span class="hljs-string">&#x27;l&#x27;</span>)] ^ <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;l&#x27;</span>))&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;enStr.index(<span class="hljs-string">&#x27;a&#x27;</span>)&#125;</span> -&gt; <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(cmpData[enStr.index(<span class="hljs-string">&#x27;a&#x27;</span>)] ^ <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>))&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;enStr.index(<span class="hljs-string">&#x27;g&#x27;</span>)&#125;</span> -&gt; <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(cmpData[enStr.index(<span class="hljs-string">&#x27;g&#x27;</span>)] ^ <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;g&#x27;</span>))&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;enStr.index(<span class="hljs-string">r&#x27;&#123;&#x27;</span>)&#125;</span> -&gt; <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(cmpData[enStr.index(<span class="hljs-string">r&#x27;&#123;&#x27;</span>)] ^ <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;&#123;&#x27;</span>))&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;enStr.index(<span class="hljs-string">r&#x27;&#125;&#x27;</span>)&#125;</span> -&gt; <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(cmpData[enStr.index(<span class="hljs-string">r&#x27;&#125;&#x27;</span>)] ^ <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;&#125;&#x27;</span>))&#125;</span>&quot;</span>)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">0 -&gt; 111</span><br><span class="hljs-string">11 -&gt; 170</span><br><span class="hljs-string">32 -&gt; 155</span><br><span class="hljs-string">12 -&gt; 2</span><br><span class="hljs-string">1 -&gt; 24</span><br><span class="hljs-string">31 -&gt; 128</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure>

<p>通过网站得到出题前的 2023.1.1的时间戳 <a target="_blank" rel="noopener" href="https://www.epochconverter.com/">Epoch Converter - Unix Timestamp<br>Converter</a>和文件的修改时间的时间戳，写爆破</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// 设置自定义的种子值</span><br>    <span class="hljs-type">int</span> cmp[] = &#123; <span class="hljs-number">111</span>, <span class="hljs-number">24</span>, <span class="hljs-number">170</span>, <span class="hljs-number">2</span>, <span class="hljs-number">128</span>, <span class="hljs-number">155</span>&#125;;<br>    <span class="hljs-type">int</span> order[] = &#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span>, <span class="hljs-number">31</span>, <span class="hljs-number">32</span>&#125;;<span class="hljs-comment">// f&#123;lg&#125;a</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> k = <span class="hljs-number">1672531200</span>; k &lt; <span class="hljs-number">1685836800</span>; k++) &#123;<br>        <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> customSeed = k;<br>        srand(customSeed);<br><br>        <span class="hljs-comment">// 生成一些随机数</span><br>        <span class="hljs-type">int</span> temp = <span class="hljs-number">0</span>;<br>        <span class="hljs-type">int</span> delta = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">33</span>; ++i) &#123;<br>            <span class="hljs-type">int</span> randomValue = rand();<br>            randomValue %= <span class="hljs-number">255</span>;<br>            <span class="hljs-keyword">if</span> (i == order[temp]) &#123;<br>                <span class="hljs-keyword">if</span> (randomValue == cmp[temp]) &#123;<br>                    delta++;<br>                &#125;<br>                temp++;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (delta == <span class="hljs-number">6</span>)<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The seed is %x\n&quot;</span>, customSeed); <span class="hljs-comment">// The seed is 64437f56</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>得到异或值</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> customSeed = <span class="hljs-number">0x64437f56</span>;<br>        srand(customSeed);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">42</span>; i++) &#123;<br>            <span class="hljs-type">int</span> randomValue = rand();<br>            <span class="hljs-comment">// printf(&quot;The randomValue-&gt; %x\nthe result = %x\n&quot;, randomValue, randomValue % 255);</span><br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;0x%x,&quot;</span>, randomValue % <span class="hljs-number">255</span>);<br>            <span class="hljs-comment">// 0x6f,0x18,0xec,0xc4,0x3a,0xba,0x5d,0x61,0x3d,0x33,0xa9,0xaa,0x2,0x11,0x71,0x8b,0xa2,0x26,0xe,0x4d,0x83,0x42,0x70,0xca,0x50,0x71,0xe7,0x6b,0xf,0x32,0x9f,0x80,0x9b,0xb7,0xe3,0xb8,0xe0,0x1c,0x10,0xb4,0x2a,0x39</span><br>        &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>根据异或值得到flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python">oStr = <span class="hljs-string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnop&#x27;</span><br>cStr = <span class="hljs-string">&#x27;AEIMQUYcgkoBDFHJLNPRTVXZbdfhjlnpCGKOSWaeim&#x27;</span><br><br>cmpData = [<span class="hljs-number">0x00000009</span>, <span class="hljs-number">0x00000063</span>, <span class="hljs-number">0x000000D9</span>, <span class="hljs-number">0x000000F6</span>, <span class="hljs-number">0x00000058</span>, <span class="hljs-number">0x000000DD</span>, <span class="hljs-number">0x0000003F</span>, <span class="hljs-number">0x0000004C</span>, <span class="hljs-number">0x0000000F</span>, <span class="hljs-number">0x0000000B</span>, <span class="hljs-number">0x00000098</span>, <span class="hljs-number">0x000000C6</span>, <span class="hljs-number">0x00000065</span>, <span class="hljs-number">0x00000021</span>, <span class="hljs-number">0x00000041</span>, <span class="hljs-number">0x000000ED</span>, <span class="hljs-number">0x000000C4</span>, <span class="hljs-number">0x0000000B</span>, <span class="hljs-number">0x0000003A</span>, <span class="hljs-number">0x0000007B</span>, <span class="hljs-number">0x000000E5</span>, <span class="hljs-number">0x00000075</span>, <span class="hljs-number">0x0000005D</span>, <span class="hljs-number">0x000000A9</span>, <span class="hljs-number">0x00000031</span>, <span class="hljs-number">0x00000041</span>, <span class="hljs-number">0x000000D7</span>, <span class="hljs-number">0x00000052</span>, <span class="hljs-number">0x0000006C</span>, <span class="hljs-number">0x0000000A</span>, <span class="hljs-number">0x000000FA</span>, <span class="hljs-number">0x000000FD</span>, <span class="hljs-number">0x000000FA</span>, <span class="hljs-number">0x00000084</span>, <span class="hljs-number">0x000000DB</span>, <span class="hljs-number">0x00000089</span>, <span class="hljs-number">0x000000CD</span>, <span class="hljs-number">0x0000007E</span>, <span class="hljs-number">0x00000027</span>, <span class="hljs-number">0x00000085</span>, <span class="hljs-number">0x00000013</span>, <span class="hljs-number">0x00000008</span>]<br>xorData = [<span class="hljs-number">0x6f</span>,<span class="hljs-number">0x18</span>,<span class="hljs-number">0xec</span>,<span class="hljs-number">0xc4</span>,<span class="hljs-number">0x3a</span>,<span class="hljs-number">0xba</span>,<span class="hljs-number">0x5d</span>,<span class="hljs-number">0x61</span>,<span class="hljs-number">0x3d</span>,<span class="hljs-number">0x33</span>,<span class="hljs-number">0xa9</span>,<span class="hljs-number">0xaa</span>,<span class="hljs-number">0x2</span>,<span class="hljs-number">0x11</span>,<span class="hljs-number">0x71</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0xa2</span>,<span class="hljs-number">0x26</span>,<span class="hljs-number">0xe</span>,<span class="hljs-number">0x4d</span>,<span class="hljs-number">0x83</span>,<span class="hljs-number">0x42</span>,<span class="hljs-number">0x70</span>,<span class="hljs-number">0xca</span>,<span class="hljs-number">0x50</span>,<span class="hljs-number">0x71</span>,<span class="hljs-number">0xe7</span>,<span class="hljs-number">0x6b</span>,<span class="hljs-number">0xf</span>,<span class="hljs-number">0x32</span>,<span class="hljs-number">0x9f</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x9b</span>,<span class="hljs-number">0xb7</span>,<span class="hljs-number">0xe3</span>,<span class="hljs-number">0xb8</span>,<span class="hljs-number">0xe0</span>,<span class="hljs-number">0x1c</span>,<span class="hljs-number">0x10</span>,<span class="hljs-number">0xb4</span>,<span class="hljs-number">0x2a</span>,<span class="hljs-number">0x39</span>]<br>res = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(cmpData)):<br>    res.append(xorData[i] ^ cmpData[i])<br>result = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> res)<br>enOrder = [cStr.index(oStr[i]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(oStr))]<br><br>flag = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(result)):<br>    flag += result[enOrder[i]]<br><span class="hljs-built_in">print</span>(flag) <span class="hljs-comment"># flag&#123;0305f8f2-14b6-fg7b-bc7a-010299c881e1&#125;</span><br></code></pre></td></tr></table></figure>







<h1 id="file-encryptor"><a href="#file-encryptor" class="headerlink" title="file_encryptor"></a>file_encryptor</h1><h2 id="0x0-去花指令"><a href="#0x0-去花指令" class="headerlink" title="0x0 去花指令"></a>0x0 去花指令</h2><p>TLS回调函数里面有反调试，TLS回调函数和main函数里面有异常处理，这些干扰了我们的分析</p>
<p>首先处理TLS回调函数中的反调试和异常处理</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c">.text:<span class="hljs-number">004018</span>DA                 test    eax, eax<br>.text:<span class="hljs-number">004018</span>DC                 jz      <span class="hljs-type">short</span> loc_401957<br>.text:<span class="hljs-number">004018</span>DE ;   __try &#123; <span class="hljs-comment">// __except at loc_401916</span><br>.text:<span class="hljs-number">004018</span>DE                 mov     [ebp+ms_exc.registration.TryLevel], <span class="hljs-number">0</span><br>.text:<span class="hljs-number">004018E5</span>                 call    ds:IsDebuggerPresent<br>.text:<span class="hljs-number">004018</span>EB                 test    eax, eax<br>.text:<span class="hljs-number">004018</span>ED                 jz      <span class="hljs-type">short</span> loc_4018F7<br>.text:<span class="hljs-number">004018</span>EF                 push    <span class="hljs-number">0</span>               ; Code<br>.text:<span class="hljs-number">004018F</span>1                 call    ds:__imp_exit<br>.text:<span class="hljs-number">004018F</span>7 ; ---------------------------------------------------------------------------<br>.text:<span class="hljs-number">004018F</span>7<br>.text:<span class="hljs-number">004018F</span>7 loc_4018F7:                             ; CODE XREF: TlsCallback_0+<span class="hljs-number">4</span>D↑j<br>.text:<span class="hljs-number">004018F</span>7                 mov     [ebp+var_20], <span class="hljs-number">0</span><br>.text:<span class="hljs-number">004018F</span>E                 mov     ecx, [ebp+var_20]<br>.text:<span class="hljs-number">00401901</span>                 mov     dword ptr [ecx], <span class="hljs-number">2</span>Ah ; <span class="hljs-string">&#x27;*&#x27;</span><br>.text:<span class="hljs-number">00401901</span> ;   &#125; <span class="hljs-comment">// starts at 4018DE</span><br>.text:<span class="hljs-number">00401907</span>                 mov     [ebp+ms_exc.registration.TryLevel], <span class="hljs-number">0F</span>FFFFFFEh<br>.text:<span class="hljs-number">0040190</span>E                 jmp     <span class="hljs-type">short</span> loc_401950<br>.text:<span class="hljs-number">00401910</span> ; ---------------------------------------------------------------------------<br>.text:<span class="hljs-number">00401910</span><br>.text:<span class="hljs-number">00401910</span> loc_401910:                             ; DATA XREF: .rdata:stru_403828↓o<br>.text:<span class="hljs-number">00401910</span> ;   __except filter <span class="hljs-comment">// owned by 4018DE</span><br>.text:<span class="hljs-number">00401910</span>                 mov     eax, <span class="hljs-number">1</span><br>.text:<span class="hljs-number">00401915</span>                 retn<br>.text:<span class="hljs-number">00401916</span> ; ---------------------------------------------------------------------------<br>.text:<span class="hljs-number">00401916</span><br>.text:<span class="hljs-number">00401916</span> loc_401916:                             ; DATA XREF: .rdata:stru_403828↓o<br>.text:<span class="hljs-number">00401916</span> ;   __except(loc_401910) <span class="hljs-comment">// owned by 4018DE</span><br>.text:<span class="hljs-number">00401916</span>                 mov     esp, [ebp+ms_exc.old_esp]<br>.text:<span class="hljs-number">00401919</span>                 mov     [ebp+var_1C], <span class="hljs-number">0</span><br>.text:<span class="hljs-number">00401920</span>                 jmp     <span class="hljs-type">short</span> loc_40192B<br></code></pre></td></tr></table></figure>

<p>过了反调试后，程序会在00401901触发异常，该异常的处理在00401916，那么从004018DA到00401916这一段的代码应该是可以直接patch掉的，Patch后：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> __stdcall <span class="hljs-title function_">TlsCallback_0</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, <span class="hljs-type">int</span> a2, <span class="hljs-type">int</span> a3)</span><br>&#123;<br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+14h] [ebp-1Ch]</span><br><br>  <span class="hljs-keyword">if</span> ( byte_405034 )<br>  &#123;<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">23</span>; ++i )<br>      byte_40501C[i] ^= <span class="hljs-number">0x22</span>u;<br>    byte_405034 = <span class="hljs-number">0</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>接下来处理main函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c">.text:<span class="hljs-number">0040199</span>A                 mov     large fs:<span class="hljs-number">0</span>, eax<br>.text:<span class="hljs-number">004019</span>A0                 mov     [ebp+ms_exc.old_esp], esp<br>.text:<span class="hljs-number">004019</span>A3 ;   __try &#123; <span class="hljs-comment">// __except at loc_4019CC</span><br>.text:<span class="hljs-number">004019</span>A3                 mov     [ebp+ms_exc.registration.TryLevel], <span class="hljs-number">0</span><br>.text:<span class="hljs-number">004019</span>AA                 mov     [ebp+var_3C], <span class="hljs-number">0</span><br>.text:<span class="hljs-number">004019B</span>1                 mov     eax, [ebp+var_3C]<br>.text:<span class="hljs-number">004019B</span>4                 mov     dword ptr [eax], <span class="hljs-number">2</span>Ah ; <span class="hljs-string">&#x27;*&#x27;</span><br>.text:<span class="hljs-number">004019B</span>4 ;   &#125; <span class="hljs-comment">// starts at 4019A3</span><br>.text:<span class="hljs-number">004019B</span>A                 mov     [ebp+ms_exc.registration.TryLevel], <span class="hljs-number">0F</span>FFFFFFEh<br>.text:<span class="hljs-number">004019</span>C1                 jmp     loc_401B18<br>.text:<span class="hljs-number">004019</span>C6 ; ---------------------------------------------------------------------------<br>.text:<span class="hljs-number">004019</span>C6<br>.text:<span class="hljs-number">004019</span>C6 loc_4019C6:                             ; DATA XREF: .rdata:stru_403848↓o<br>.text:<span class="hljs-number">004019</span>C6 ;   __except filter <span class="hljs-comment">// owned by 4019A3</span><br>.text:<span class="hljs-number">004019</span>C6                 mov     eax, <span class="hljs-number">1</span><br>.text:<span class="hljs-number">004019</span>CB                 retn<br>.text:<span class="hljs-number">004019</span>CC ; ---------------------------------------------------------------------------<br>.text:<span class="hljs-number">004019</span>CC<br>.text:<span class="hljs-number">004019</span>CC loc_4019CC:                             ; DATA XREF: .rdata:stru_403848↓o<br>.text:<span class="hljs-number">004019</span>CC ;   __except(loc_4019C6) <span class="hljs-comment">// owned by 4019A3</span><br>.text:<span class="hljs-number">004019</span>CC                 mov     esp, [ebp+ms_exc.old_esp]<br>.text:<span class="hljs-number">004019</span>CF                 push    <span class="hljs-number">0</span>               ; lpModuleName<br>.text:<span class="hljs-number">004019</span>D1                 call    ds:GetModuleHandleW<br></code></pre></td></tr></table></figure>

<p>004019B4处的异常触发会跳转到004019CC，从004019A3到004019CC之间的代码都可以nop掉<br>这里有一个花指令</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">.text:<span class="hljs-number">008419F</span>5                 call    sub_842140<br>.text:<span class="hljs-number">008419F</span>A                 call    near ptr <span class="hljs-number">15</span>C9782h<br></code></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">.text:<span class="hljs-number">00842140</span> sub_842140      proc near               ; CODE XREF: .text:<span class="hljs-number">00841329</span>↑p<br>.text:<span class="hljs-number">00842140</span>                                         ; _main+<span class="hljs-number">85</span>↑p<br>.text:<span class="hljs-number">00842140</span>                 add     dword ptr [esp+<span class="hljs-number">0</span>], <span class="hljs-number">1</span><br>.text:<span class="hljs-number">00842144</span>                 retn<br>.text:<span class="hljs-number">00842144</span> sub_842140      endp<br></code></pre></td></tr></table></figure>

<p><code>sub_842140</code> 函数中调整了函数返回后的下一条地址，也就是返回地址是<br>008419FB，patch修改一下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c">.text:<span class="hljs-number">008419F</span>2                 mov     [ebp+hResInfo], eax<br>.text:<span class="hljs-number">008419F</span>5                 nop<br>.text:<span class="hljs-number">008419F</span>6                 nop<br>.text:<span class="hljs-number">008419F</span>7                 nop<br>.text:<span class="hljs-number">008419F</span>8                 nop<br>.text:<span class="hljs-number">008419F</span>9                 nop<br>.text:<span class="hljs-number">008419F</span>A                 nop<br>.text:<span class="hljs-number">008419F</span>B                 cmp     [ebp+hResInfo], <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>

<p>修改后就可以见到较为完整的伪代码了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">void</span> *Src; <span class="hljs-comment">// [esp+24h] [ebp-34h]</span><br>  HGLOBAL hResData; <span class="hljs-comment">// [esp+28h] [ebp-30h]</span><br>  HMODULE hModule; <span class="hljs-comment">// [esp+2Ch] [ebp-2Ch]</span><br>  HRSRC hResInfo; <span class="hljs-comment">// [esp+30h] [ebp-28h]</span><br>  DWORD Size; <span class="hljs-comment">// [esp+34h] [ebp-24h]</span><br>  DWORD i; <span class="hljs-comment">// [esp+38h] [ebp-20h]</span><br>  <span class="hljs-type">void</span> *v10; <span class="hljs-comment">// [esp+3Ch] [ebp-1Ch]</span><br><br>  hModule = GetModuleHandleW(<span class="hljs-number">0</span>);<br>  hResInfo = FindResourceW(hModule, (LPCWSTR)<span class="hljs-number">0x65</span>, <span class="hljs-string">L&quot;DATA&quot;</span>);<br>  <span class="hljs-keyword">if</span> ( hResInfo )<br>  &#123;<br>    Size = SizeofResource(hModule, hResInfo);<br>    hResData = LoadResource(hModule, hResInfo);<br>    v10 = (<span class="hljs-type">void</span> *)sub_842156(Size);<br>    <span class="hljs-keyword">if</span> ( hResData )<br>    &#123;<br>      Src = LockResource(hResData);<br>      <span class="hljs-keyword">if</span> ( Src )<br>      &#123;<br>        <span class="hljs-built_in">memcpy</span>(v10, Src, Size);<br>        <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; Size; ++i )<br>          *((_BYTE *)v10 + i) ^= <span class="hljs-number">0x33</span>u;<br>        dword_84541C = sub_841CE0(v10, Size);<br>      &#125;<br>      FreeResource(hResData);<br>    &#125;<br>    j_j_free(v10);<br>  &#125;<br>  ((<span class="hljs-type">void</span> (*)(<span class="hljs-type">void</span>))loc_841320)();<br>  sub_842000();<br>  system(<span class="hljs-string">&quot;pause&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>类似的花指令还有</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c">.text:<span class="hljs-number">00841320</span>                 push    ebp<br>.text:<span class="hljs-number">00841321</span>                 mov     ebp, esp<br>.text:<span class="hljs-number">00841323</span>                 sub     esp, <span class="hljs-number">1</span>Ch<br>.text:<span class="hljs-number">00841326</span>                 push    ebx<br>.text:<span class="hljs-number">00841327</span>                 push    esi<br>.text:<span class="hljs-number">00841328</span>                 push    edi<br>.text:<span class="hljs-number">00841329</span>                 call    sub_842140<br>.text:<span class="hljs-number">0084132</span>E                 call    near ptr <span class="hljs-number">81301B</span>h<br>.text:<span class="hljs-number">00841333</span>                 inc     dword ptr [ebp<span class="hljs-number">-767B</span>F040h]<br></code></pre></td></tr></table></figure>

<p>同样的进行Patch处理</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c">.text:<span class="hljs-number">00841328</span>                 push    edi<br>.text:<span class="hljs-number">00841329</span>                 nop<br>.text:<span class="hljs-number">0084132</span>A                 nop<br>.text:<span class="hljs-number">0084132B</span>                 nop<br>.text:<span class="hljs-number">0084132</span>C                 nop<br>.text:<span class="hljs-number">0084132</span>D                 nop<br>.text:<span class="hljs-number">0084132</span>E                 nop<br>.text:<span class="hljs-number">0084132F</span>                 call    sub_841050<br></code></pre></td></tr></table></figure>

<p>此时整个程序就较为清晰了</p>
<h2 id="0x1-分析-1"><a href="#0x1-分析-1" class="headerlink" title="0x1 分析"></a>0x1 分析</h2><p>相当于附件中还有另一个程序，程序先加载这个程序，然后进行解密，解密后得到</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">cryptsp.dll:00E30000 cryptsp_dll     segment byte public &#x27;CODE&#x27; use32<br>cryptsp.dll:00E30000                 assume cs:cryptsp_dll<br>cryptsp.dll:00E30000                 ;org 0E30000h<br>cryptsp.dll:00E30000                 assume es:debug013, ss:debug013, ds:debug013, fs:debug013, gs:debug013<br>cryptsp.dll:00E30000                 db  4Dh ; M<br>cryptsp.dll:00E30001                 db  5Ah ; Z<br>cryptsp.dll:00E30002                 db  90h<br></code></pre></td></tr></table></figure>

<p>在函数sub_F81050中，检查了卷序列号</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">sub_F81050</span><span class="hljs-params">()</span><br>&#123;<br>  DWORD VolumeSerialNumber; <span class="hljs-comment">// [esp+4h] [ebp-8h] BYREF</span><br><br>  VolumeSerialNumber = <span class="hljs-number">0</span>;<br>  GetVolumeInformationA(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, &amp;VolumeSerialNumber, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">if</span> ( VolumeSerialNumber == <span class="hljs-number">0x7DAB1D35</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0x7DAB1D35</span>;<br>  <span class="hljs-keyword">else</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>卷序列号是一个唯一标识磁盘卷的数值，这里我们需要手动跳过一下，或者修改程序，直接让其返回</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">sub_F82000</span><span class="hljs-params">()</span><br>&#123;<br>  HANDLE hFindFile; <span class="hljs-comment">// [esp+0h] [ebp-874h]</span><br>  PWSTR ppszPath; <span class="hljs-comment">// [esp+4h] [ebp-870h] BYREF</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">WIN32_FIND_DATAW</span> <span class="hljs-title">FindFileData</span>;</span> <span class="hljs-comment">// [esp+8h] [ebp-86Ch] BYREF</span><br>  WCHAR v3[<span class="hljs-number">260</span>]; <span class="hljs-comment">// [esp+258h] [ebp-61Ch] BYREF</span><br>  WCHAR FileName[<span class="hljs-number">260</span>]; <span class="hljs-comment">// [esp+460h] [ebp-414h] BYREF</span><br>  WCHAR pszDest[<span class="hljs-number">260</span>]; <span class="hljs-comment">// [esp+668h] [ebp-20Ch] BYREF</span><br><br>  <span class="hljs-keyword">if</span> ( !SHGetKnownFolderPath(&amp;rfid, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, &amp;ppszPath) )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( PathCombineW(pszDest, ppszPath, <span class="hljs-string">L&quot;document&quot;</span>) )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( PathCombineW(FileName, pszDest, <span class="hljs-string">L&quot;*.*&quot;</span>) )<br>      &#123;<br>        hFindFile = FindFirstFileW(FileName, &amp;FindFileData);<br>        <span class="hljs-keyword">if</span> ( hFindFile != (HANDLE)<span class="hljs-number">-1</span> )<br>        &#123;<br>          <span class="hljs-keyword">do</span><br>          &#123;<br>            <span class="hljs-keyword">if</span> ( FindFileData.cFileName[<span class="hljs-number">0</span>] != <span class="hljs-number">46</span> )<br>            &#123;<br>              PathCombineW(v3, pszDest, FindFileData.cFileName);<br>              sub_F817E0(FindFileData.cFileName, v3);<br>            &#125;<br>          &#125;<br>          <span class="hljs-keyword">while</span> ( FindNextFileW(hFindFile, &amp;FindFileData) );<br>          FindClose(hFindFile);<br>        &#125;<br>      &#125;<br>    &#125;<br>    CoTaskMemFree(ppszPath);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>上述代码遍历了用户目录的文档目录<br><img src="/./img/ichunqiu2023/558946fb52b8d287dac4e31663bce662779e9825.png" srcset="/img/loading.gif" lazyload><br>形成了通配符<br><img src="/./img/ichunqiu2023/e3213b1cb1761db5eae0f79d24a99a31f26bb350.png" srcset="/img/loading.gif" lazyload><br>得把文件放到这个目录<br><img src="/./img/ichunqiu2023/1c1ba7076b387204058f2951e85412386bea5143.png" srcset="/img/loading.gif" lazyload><br>进入函数之后，发现有rsa相关特征</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c">debug022:<span class="hljs-number">007</span>D7360 off_7D7360      dd offset rsaenh_CPGenKey<br>...<br>debug022:<span class="hljs-number">007</span>CA5E0 off_7CA5E0      dd offset rsaenh_CPAcquireContext<br></code></pre></td></tr></table></figure>

<p>跟进去之后，调用了解密的cryptsp.dll<br>因为是对文件进行加密，我们直接找到加密的地方</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> ( !v6(*a1, <span class="hljs-number">0</span>, FileSize == <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, lpBuffer, &amp;NumberOfBytesRead, dwBytes)<br>  || !WriteFile(hFile, lpBuffer, NumberOfBytesRead, &amp;NumberOfBytesRead, <span class="hljs-number">0</span>) )<br></code></pre></td></tr></table></figure>

<p>这里的v6是dll中的一个函数，跟进v6，调用了 rasenh.dll 中的CPEncrypt函数<br><img src="/./img/ichunqiu2023/b869c09b5ff8b62413f40e64ec870e29f615514e.png" srcset="/img/loading.gif" lazyload><br>经过调试呢，发现就是这里进行的加密，也就是CPEncrypt函数进行加密</p>
<h2 id="0x2-求解-1"><a href="#0x2-求解-1" class="headerlink" title="0x2 求解"></a>0x2 求解</h2><p>去分析这个文件的加密有点复杂，因为这个dll里面是有解密函数的，我们可以通过更改调用函数实现解密<br>找到CPDecrypt函数<br><img src="/./img/ichunqiu2023/c091f7229a49472c793498612853af7cfbcf2080.png" srcset="/img/loading.gif" lazyload><br>将esi寄存器的值修改为这个，直接F9 之后看1.txt<br><img src="/./img/ichunqiu2023/84285630a8789385574450999657ac778a573e6b.png" srcset="/img/loading.gif" lazyload><br>得到了flag</p>
<h1 id="coos"><a href="#coos" class="headerlink" title="coos"></a>coos</h1><h2 id="0x0-分析"><a href="#0x0-分析" class="headerlink" title="0x0 分析"></a>0x0 分析</h2><p>main函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">main_0</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">char</span> v4; <span class="hljs-comment">// [esp+0h] [ebp-184h]</span><br>  <span class="hljs-type">char</span> v5; <span class="hljs-comment">// [esp+0h] [ebp-184h]</span><br>  <span class="hljs-type">int</span> v6; <span class="hljs-comment">// [esp+Ch] [ebp-178h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+D8h] [ebp-ACh]</span><br>  <span class="hljs-type">int</span> *a2; <span class="hljs-comment">// [esp+E4h] [ebp-A0h] BYREF</span><br>  _QWORD v9[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [esp+E8h] [ebp-9Ch] BYREF</span><br>  <span class="hljs-type">int</span> *Str[<span class="hljs-number">27</span>]; <span class="hljs-comment">// [esp+10Ch] [ebp-78h] BYREF</span><br>  <span class="hljs-type">int</span> **ta; <span class="hljs-comment">// [esp+178h] [ebp-Ch]</span><br><br>  __CheckForDebuggerJustMyCode(&amp;unk_972016);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, dword_9705D0[<span class="hljs-number">0</span>]);<br>  sub_9612D0();                                 <span class="hljs-comment">// 初始化相关内存</span><br>  sub_96128A();                                 <span class="hljs-comment">// 相关数据赋值</span><br>  ta = <span class="hljs-number">0</span>;<br>  j_memset(Str, <span class="hljs-number">0</span>, <span class="hljs-number">0x64</span>u);<br>  deData(&amp;unk_96F5AC);                          <span class="hljs-comment">// 解密输出 “plz input ...”</span><br>  <span class="hljs-built_in">printf</span>(&amp;unk_96F5AC, v4);<br>  deData(&amp;unk_96F5AC);<br>  deData(aC);                                   <span class="hljs-comment">// 解密 %s</span><br>  <span class="hljs-built_in">scanf</span>(aC, (<span class="hljs-type">char</span>)Str);<br>  deData(aC);<br>  <span class="hljs-keyword">if</span> ( j_strlen((<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)Str) != <span class="hljs-number">32</span> )<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>  ta = Str;<br>  a2 = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">memset</span>(v9, <span class="hljs-number">0</span>, <span class="hljs-number">0x1C</span>);<br>  Encrypt((<span class="hljs-type">int</span> *)Str, (<span class="hljs-type">int</span> *)&amp;a2);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; ++i )<br>  &#123;<br>    v6 = dword_9704C8[i + <span class="hljs-number">44</span>];<br>    <span class="hljs-keyword">if</span> ( (&amp;a2)[<span class="hljs-number">2</span> * i] != (<span class="hljs-type">int</span> *)dword_96E280[<span class="hljs-number">2</span> * v6] || LODWORD(v9[i]) != dword_96E284[<span class="hljs-number">2</span> * v6] )<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>  &#125;<br>  deData(&amp;unk_96F5C4);<br>  <span class="hljs-built_in">printf</span>(&amp;unk_96F5C4, v5);<br>  deData(&amp;unk_96F5C4);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>可知长度是32，在主要的加密函数中有一个switch语句，还有很多分支，分析了一下，发现是一个虚拟机逆向，大概是个用32位模拟64位环境的过程<br>调试分析较为麻烦，这里就使用之前用过的idapython来使得在调试的过程中能够打印出相应的操作</p>
<h2 id="0x1-IDApython-脚本编写"><a href="#0x1-IDApython-脚本编写" class="headerlink" title="0x1 IDApython 脚本编写"></a>0x1 IDApython 脚本编写</h2><p>我将switch语句中用到的一些函数进行了分析，用一些指令来表示他们 </p>
<blockquote>
<p>这里面的PUSH 和 POP 写的有点随便</p>
</blockquote>
<p>然后在适当的位置下断点，通过读取寄存器的值，打印当前函数的主要功能</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> idc<br><span class="hljs-keyword">import</span> ida_dbg<br><span class="hljs-keyword">import</span> idaapi<br><br>BASE_ADDR = idaapi.get_imagebase()<br><br><span class="hljs-comment"># 断点字典</span><br>BPT_DICT = &#123;<span class="hljs-string">&#x27;MOV&#x27;</span>:<span class="hljs-number">0x1484A</span>,<br>            <span class="hljs-string">&#x27;PUSH&#x27;</span>:<span class="hljs-number">0x14A29</span>,<br>            <span class="hljs-string">&#x27;POP&#x27;</span>: <span class="hljs-number">0x149A8</span>,<br>            <span class="hljs-string">&#x27;SHL&#x27;</span>: <span class="hljs-number">0x14C1C</span>,<br>            <span class="hljs-string">&#x27;SHR&#x27;</span>: <span class="hljs-number">0x14C7C</span>,<br>            <span class="hljs-string">&#x27;ADD&#x27;</span>: <span class="hljs-number">0x12D96</span>,<br>            <span class="hljs-string">&#x27;XOR&#x27;</span>: <span class="hljs-number">0x12D36</span>,<br>            <span class="hljs-string">&#x27;AND&#x27;</span>: <span class="hljs-number">0x12BD6</span><br>            &#125;<br><br><span class="hljs-comment"># 终止条件</span><br>BPT_DICT[<span class="hljs-string">&#x27;END&#x27;</span>] = <span class="hljs-number">0x1513B</span><br><br><span class="hljs-comment"># 断点</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">bpt</span>(<span class="hljs-params">arr</span>):<br>    arr = <span class="hljs-built_in">list</span>(arr)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(arr)):<br>        idc.add_bpt(arr[i]+BASE_ADDR)<br><br><br><span class="hljs-comment"># 分发器</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dispatcher</span>(<span class="hljs-params">addr</span>):<br>    opcode = <span class="hljs-built_in">next</span>((key <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> BPT_DICT.items() <span class="hljs-keyword">if</span> value == (addr-BASE_ADDR)), <span class="hljs-string">&#x27;&#x27;</span>)<br>    <span class="hljs-keyword">if</span> opcode == <span class="hljs-string">&#x27;MOV&#x27;</span>:<br>        a1 = idc.get_reg_value(<span class="hljs-string">&#x27;eax&#x27;</span>)<br>        a2 = idc.get_reg_value(<span class="hljs-string">&#x27;ecx&#x27;</span>)<br>        a3 = idc.get_reg_value(<span class="hljs-string">&#x27;edx&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;MOV : [<span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(a1)&#125;</span>] = <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(a3)&#125;</span> <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(a2)&#125;</span> &quot;</span>)<br>    <br>    <span class="hljs-keyword">elif</span> opcode == <span class="hljs-string">&#x27;PUSH&#x27;</span>:<br>        num = idc.get_reg_value(<span class="hljs-string">&#x27;eax&#x27;</span>)<br>        a1 = idc.get_reg_value(<span class="hljs-string">&#x27;ecx&#x27;</span>)<br>        a2 = idc.get_reg_value(<span class="hljs-string">&#x27;edx&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;PUSH: 0x51FBA8[<span class="hljs-subst">&#123;num&#125;</span>] = <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(a2)&#125;</span> <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(a1)&#125;</span> &quot;</span>)<br>    <br>    <span class="hljs-keyword">elif</span> opcode == <span class="hljs-string">&#x27;POP&#x27;</span>:<br>        num = idc.get_reg_value(<span class="hljs-string">&#x27;eax&#x27;</span>)<br>        a1 = idc.get_reg_value(<span class="hljs-string">&#x27;edx&#x27;</span>)<br>        a2 = idc.get_reg_value(<span class="hljs-string">&#x27;ecx&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;POP: [<span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(num)&#125;</span>] =  <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(a2)&#125;</span> <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(a1)&#125;</span>&quot;</span>)<br><br>    <span class="hljs-keyword">elif</span> opcode == <span class="hljs-string">&#x27;SHL&#x27;</span>:<br>        a2 = idc.get_reg_value(<span class="hljs-string">&#x27;ecx&#x27;</span>)<br>        a1H = idc.get_reg_value(<span class="hljs-string">&#x27;eax&#x27;</span>)<br>        a1L = idc.get_reg_value(<span class="hljs-string">&#x27;edx&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;SHL: <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(a1L)&#125;</span> <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(a1H)&#125;</span> &lt;&lt; <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(a2)&#125;</span>&quot;</span>)<br>    <br>    <span class="hljs-keyword">elif</span> opcode == <span class="hljs-string">&#x27;SHR&#x27;</span>:<br>        a2 = idc.get_reg_value(<span class="hljs-string">&#x27;ecx&#x27;</span>)<br>        a1H = idc.get_reg_value(<span class="hljs-string">&#x27;eax&#x27;</span>)<br>        a1L = idc.get_reg_value(<span class="hljs-string">&#x27;edx&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;SHR: <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(a1L)&#125;</span> <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(a1H)&#125;</span> &gt;&gt; <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(a2)&#125;</span>&quot;</span>)<br><br>    <span class="hljs-keyword">elif</span> opcode == <span class="hljs-string">&#x27;ADD&#x27;</span>:<br>        a1 = idc.get_reg_value(<span class="hljs-string">&#x27;ecx&#x27;</span>)<br>        ebp = idc.get_reg_value(<span class="hljs-string">&#x27;ebp&#x27;</span>)<br>        a2 = idc.read_dbg_qword(ebp + <span class="hljs-number">0xc</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ADD: <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(a1)&#125;</span> += <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(a2)&#125;</span>&quot;</span>)<br>    <br>    <span class="hljs-keyword">elif</span> opcode == <span class="hljs-string">&#x27;XOR&#x27;</span>:<br>        eax = idc.get_reg_value(<span class="hljs-string">&#x27;eax&#x27;</span>)<br>        a1 = idc.read_dbg_qword(eax)<br>        ebp = idc.get_reg_value(<span class="hljs-string">&#x27;ebp&#x27;</span>)<br>        a2 = idc.read_dbg_qword(ebp + <span class="hljs-number">0xc</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;XOR: <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(a1)&#125;</span> ^= <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(a2)&#125;</span>&quot;</span>)<br>    <br>    <span class="hljs-keyword">elif</span> opcode == <span class="hljs-string">&#x27;AND&#x27;</span>:<br>        eax = idc.get_reg_value(<span class="hljs-string">&#x27;eax&#x27;</span>)<br>        a1 = idc.read_dbg_qword(eax)<br>        ebp = idc.get_reg_value(<span class="hljs-string">&#x27;ebp&#x27;</span>)<br>        a2 = idc.read_dbg_qword(ebp + <span class="hljs-number">0xc</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;AND: <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(a1)&#125;</span> &amp;= <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(a2)&#125;</span>&quot;</span>)<br>    <br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;The addr is <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(addr)&#125;</span>, THe opcode is <span class="hljs-subst">&#123;opcode&#125;</span>. Something Wrong.&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-comment"># </span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*] Begin&quot;</span>)<br><br>    <span class="hljs-comment"># 获取基址</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;BASE_ADDR= &#x27;</span> + <span class="hljs-built_in">hex</span>(BASE_ADDR))<br>    <br><br>    <span class="hljs-comment"># 打上断点</span><br>    bpt(BPT_DICT.values())<br><br><br>    <span class="hljs-comment"># 执行</span><br>    idc.run_to(BPT_DICT[<span class="hljs-string">&#x27;END&#x27;</span>]+BASE_ADDR)<br>    idc.wait_for_next_event(ida_dbg.WFNE_SUSP, -<span class="hljs-number">1</span>)<br>    CurrEIP = idc.get_reg_value(<span class="hljs-string">&#x27;eip&#x27;</span>)<br>    <span class="hljs-comment"># 判断是否到达终止条件</span><br>    <span class="hljs-keyword">while</span>(CurrEIP != BPT_DICT[<span class="hljs-string">&#x27;END&#x27;</span>]+BASE_ADDR):<br>        <span class="hljs-comment"># 判断断点是否合法</span><br>        <span class="hljs-keyword">if</span> (CurrEIP-BASE_ADDR) <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> BPT_DICT.values():<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Something Wrong. The EIP is <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(CurrEIP)&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-comment"># 分发处理</span><br>        dispatcher(CurrEIP)<br><br>        <span class="hljs-comment"># 下一轮循环</span><br>        idc.run_to(BPT_DICT[<span class="hljs-string">&#x27;END&#x27;</span>]+BASE_ADDR)<br>        idc.wait_for_next_event(ida_dbg.WFNE_SUSP, -<span class="hljs-number">1</span>)<br>        CurrEIP = idc.get_reg_value(<span class="hljs-string">&#x27;eip&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br></code></pre></td></tr></table></figure>

<p>处理得很慢，大概需要个十分钟左右，得到下面的结果（因为是8字节一组的加密，这里只选取一组数据，并展示其的几十行）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs c">[*] Begin<br>BASE_ADDR= <span class="hljs-number">0x500000</span><br>MOV : [<span class="hljs-number">0x51fb88</span>] = <span class="hljs-number">0x0</span> <span class="hljs-number">0x0</span> <br>PUSH: <span class="hljs-number">0x51FBA8</span>[<span class="hljs-number">1</span>] = <span class="hljs-number">0x31313131</span> <span class="hljs-number">0x31313131</span> <br>PUSH: <span class="hljs-number">0x51FBA8</span>[<span class="hljs-number">2</span>] = <span class="hljs-number">0x696c6f76</span> <span class="hljs-number">0x65696368</span> <br>POP: [<span class="hljs-number">0x51fb78</span>] =  <span class="hljs-number">0x696c6f76</span> <span class="hljs-number">0x65696368</span><br>POP: [<span class="hljs-number">0x51fb80</span>] =  <span class="hljs-number">0x31313131</span> <span class="hljs-number">0x31313131</span><br>XOR: <span class="hljs-number">0x696c6f7665696368</span> ^= <span class="hljs-number">0x3131313131313131</span><br>XOR: <span class="hljs-number">0x585d5e4754585259</span> ^= <span class="hljs-number">0x33</span><br>MOV : [<span class="hljs-number">0x51fba0</span>] = <span class="hljs-number">0x0</span> <span class="hljs-number">0x0</span> <br>MOV : [<span class="hljs-number">0x51fb88</span>] = <span class="hljs-number">0x0</span> <span class="hljs-number">0x0</span> <br>MOV : [<span class="hljs-number">0x51fb78</span>] = <span class="hljs-number">0x0</span> <span class="hljs-number">0x0</span> <br>SHL: <span class="hljs-number">0x0</span> <span class="hljs-number">0x0</span> &lt;&lt; <span class="hljs-number">0x2</span><br>MOV : [<span class="hljs-number">0x51fb80</span>] = <span class="hljs-number">0x585d5e47</span> <span class="hljs-number">0x5458526a</span> <br>SHR: <span class="hljs-number">0x585d5e47</span> <span class="hljs-number">0x5458526a</span> &gt;&gt; <span class="hljs-number">0x0</span><br>MOV : [<span class="hljs-number">0x51fb78</span>] = <span class="hljs-number">0x585d5e47</span> <span class="hljs-number">0x5458526a</span> <br>XOR: <span class="hljs-number">0x585d5e475458526a</span> &amp;= <span class="hljs-number">0xf</span><br>MOV : [<span class="hljs-number">0x51fb80</span>] = <span class="hljs-number">0x0</span> <span class="hljs-number">0x0</span> <br>MOV : [<span class="hljs-number">0x51fb90</span>] = <span class="hljs-number">0x0</span> <span class="hljs-number">0x0</span> <br>SHL: <span class="hljs-number">0x0</span> <span class="hljs-number">0x0</span> &lt;&lt; <span class="hljs-number">0x2</span><br>SHL: <span class="hljs-number">0x0</span> <span class="hljs-number">0x0</span> &lt;&lt; <span class="hljs-number">0x0</span><br>ADD: <span class="hljs-number">0x0</span> += <span class="hljs-number">0x0</span><br>ADD: <span class="hljs-number">0x0</span> += <span class="hljs-number">0x1</span><br>MOV : [<span class="hljs-number">0x51fb78</span>] = <span class="hljs-number">0x0</span> <span class="hljs-number">0x1</span> <br>SHL: <span class="hljs-number">0x0</span> <span class="hljs-number">0x1</span> &lt;&lt; <span class="hljs-number">0x2</span><br>MOV : [<span class="hljs-number">0x51fb80</span>] = <span class="hljs-number">0x585d5e47</span> <span class="hljs-number">0x5458526a</span> <br>SHR: <span class="hljs-number">0x585d5e47</span> <span class="hljs-number">0x5458526a</span> &gt;&gt; <span class="hljs-number">0x4</span><br>MOV : [<span class="hljs-number">0x51fb78</span>] = <span class="hljs-number">0x585d5e4</span> <span class="hljs-number">0x75458526</span> <br>XOR: <span class="hljs-number">0x585d5e475458526</span> &amp;= <span class="hljs-number">0xf</span><br>MOV : [<span class="hljs-number">0x51fb80</span>] = <span class="hljs-number">0x0</span> <span class="hljs-number">0xe</span> <br>MOV : [<span class="hljs-number">0x51fb90</span>] = <span class="hljs-number">0x0</span> <span class="hljs-number">0x1</span> <br>SHL: <span class="hljs-number">0x0</span> <span class="hljs-number">0x1</span> &lt;&lt; <span class="hljs-number">0x2</span><br>SHL: <span class="hljs-number">0x0</span> <span class="hljs-number">0xe</span> &lt;&lt; <span class="hljs-number">0x4</span><br>ADD: <span class="hljs-number">0x0</span> += <span class="hljs-number">0xe0</span><br>ADD: <span class="hljs-number">0x1</span> += <span class="hljs-number">0x1</span><br>MOV : [<span class="hljs-number">0x51fb78</span>] = <span class="hljs-number">0x0</span> <span class="hljs-number">0x2</span> <br>SHL: <span class="hljs-number">0x0</span> <span class="hljs-number">0x2</span> &lt;&lt; <span class="hljs-number">0x2</span><br>MOV : [<span class="hljs-number">0x51fb80</span>] = <span class="hljs-number">0x585d5e47</span> <span class="hljs-number">0x5458526a</span> <br>SHR: <span class="hljs-number">0x585d5e47</span> <span class="hljs-number">0x5458526a</span> &gt;&gt; <span class="hljs-number">0x8</span><br>...<br>SHR: <span class="hljs-number">0xdf6289f3</span> <span class="hljs-number">0x20c409d</span> &gt;&gt; <span class="hljs-number">0x3f</span><br>MOV : [<span class="hljs-number">0x51fb78</span>] = <span class="hljs-number">0x0</span> <span class="hljs-number">0x1</span> <br>XOR: <span class="hljs-number">0x1</span> &amp;= <span class="hljs-number">0x1</span><br>MOV : [<span class="hljs-number">0x51fb80</span>] = <span class="hljs-number">0x0</span> <span class="hljs-number">0x0</span> <br>SHL: <span class="hljs-number">0x0</span> <span class="hljs-number">0x1</span> &lt;&lt; <span class="hljs-number">0x0</span><br>ADD: <span class="hljs-number">0x9847c872</span> += <span class="hljs-number">0x1</span><br>ADD: <span class="hljs-number">0x3f</span> += <span class="hljs-number">0x1</span><br>PUSH: <span class="hljs-number">0x51FBA8</span>[<span class="hljs-number">1</span>] = <span class="hljs-number">0xc0e302ce</span> <span class="hljs-number">0x9847c873</span> <br>PUSH: <span class="hljs-number">0x51FBA8</span>[<span class="hljs-number">2</span>] = <span class="hljs-number">0xcb51f952</span> <span class="hljs-number">0x43105185</span> <br>POP: [<span class="hljs-number">0x51fb78</span>] =  <span class="hljs-number">0xcb51f952</span> <span class="hljs-number">0x43105185</span><br>POP: [<span class="hljs-number">0x51fb80</span>] =  <span class="hljs-number">0xc0e302ce</span> <span class="hljs-number">0x9847c873</span><br>XOR: <span class="hljs-number">0xcb51f95243105185</span> ^= <span class="hljs-number">0xc0e302ce9847c873</span><br>XOR: <span class="hljs-number">0xbb2fb9cdb5799f6</span> ^= <span class="hljs-number">0x33</span><br></code></pre></td></tr></table></figure>

<p>其中，有一些数据的来源无法确定，还需要经过调试。</p>
<h2 id="0x2-复现算法-求解"><a href="#0x2-复现算法-求解" class="headerlink" title="0x2 复现算法&amp;求解"></a>0x2 复现算法&amp;求解</h2><p>经过调试后，发现其加密算法大概如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python">xorData = [<span class="hljs-number">0x696C6F7665696368</span>, <span class="hljs-number">0xCEADD4F8344B7D10</span>, <span class="hljs-number">0xCEBF000259A5B1DB</span>, <span class="hljs-number">0xD1EE63EA2F3AB735</span>, <span class="hljs-number">0xF7EBA4C0BB3AFC6A</span>, <span class="hljs-number">0x0FCB5F041F47B9F6</span>, <span class="hljs-number">0x7BAC2E8CEFDFAE97</span>, <span class="hljs-number">0x2CE86AE8883F2D42</span>, <span class="hljs-number">0x98CDB684B9EEB0A8</span>, <span class="hljs-number">0xC8F10A0794B3A1E3</span>, <span class="hljs-number">0xA89E4C0DEA6336BB</span>, <span class="hljs-number">0xAD4DC0BA7323C479</span>, <span class="hljs-number">0xBA2FC2EC42A27960</span>, <span class="hljs-number">0x52287D00F6B53759</span>, <span class="hljs-number">0x6FC4C7BD96E8BF25</span>, <span class="hljs-number">0x84A63D6C5D48A1C4</span>, <span class="hljs-number">0x3C37F71239BF1354</span>, <span class="hljs-number">0xE4A9BB13CA1298E3</span>, <span class="hljs-number">0xA551883F04F0DFA7</span>, <span class="hljs-number">0x138696DAE392A6B7</span>, <span class="hljs-number">0x1CFCE1EF4E954623</span>, <span class="hljs-number">0xA7EB1762FC4E1A5F</span>, <span class="hljs-number">0x22BFD0AA9873F3DF</span>, <span class="hljs-number">0x19174775129FAC47</span>, <span class="hljs-number">0x1A834072808AFF42</span>, <span class="hljs-number">0x943851D760645D1C</span>, <span class="hljs-number">0x32BD54D0A06A0D46</span>, <span class="hljs-number">0x7AC4490F2250E153</span>, <span class="hljs-number">0xD06535542CCAF560</span>, <span class="hljs-number">0xC414628E29EB1142</span>, <span class="hljs-number">0x01C3F8BAF34194B8</span>, <span class="hljs-number">0xCB51F95243105185</span>]<br><span class="hljs-built_in">input</span> = [<span class="hljs-number">0x3131313131313131</span>] * <span class="hljs-number">4</span><br>BoxA = [<span class="hljs-number">0x0000000000000002</span>, <span class="hljs-number">0x0000000000000001</span>, <span class="hljs-number">0x0000000000000007</span>, <span class="hljs-number">0x0000000000000004</span>, <span class="hljs-number">0x0000000000000008</span>, <span class="hljs-number">0x000000000000000F</span>, <span class="hljs-number">0x000000000000000E</span>, <span class="hljs-number">0x0000000000000003</span>, <span class="hljs-number">0x000000000000000D</span>, <span class="hljs-number">0x000000000000000A</span>, <span class="hljs-number">0x0000000000000000</span>, <span class="hljs-number">0x0000000000000009</span>, <span class="hljs-number">0x000000000000000B</span>, <span class="hljs-number">0x0000000000000006</span>, <span class="hljs-number">0x0000000000000005</span>, <span class="hljs-number">0x000000000000000C</span>, <span class="hljs-number">0x000000000000003F</span>, <span class="hljs-number">0x000000000000002F</span>, <span class="hljs-number">0x000000000000001F</span>, <span class="hljs-number">0x000000000000000F</span>, <span class="hljs-number">0x000000000000003E</span>, <span class="hljs-number">0x000000000000002E</span>, <span class="hljs-number">0x000000000000001E</span>, <span class="hljs-number">0x000000000000000E</span>, <span class="hljs-number">0x000000000000003D</span>, <span class="hljs-number">0x000000000000002D</span>, <span class="hljs-number">0x000000000000001D</span>, <span class="hljs-number">0x000000000000000D</span>, <span class="hljs-number">0x000000000000003C</span>, <span class="hljs-number">0x000000000000002C</span>, <span class="hljs-number">0x000000000000001C</span>, <span class="hljs-number">0x000000000000000C</span>, <span class="hljs-number">0x000000000000003B</span>, <span class="hljs-number">0x000000000000002B</span>, <span class="hljs-number">0x000000000000001B</span>, <span class="hljs-number">0x000000000000000B</span>, <span class="hljs-number">0x000000000000003A</span>, <span class="hljs-number">0x000000000000002A</span>, <span class="hljs-number">0x000000000000001A</span>, <span class="hljs-number">0x000000000000000A</span>, <span class="hljs-number">0x0000000000000039</span>, <span class="hljs-number">0x0000000000000029</span>, <span class="hljs-number">0x0000000000000019</span>, <span class="hljs-number">0x0000000000000009</span>, <span class="hljs-number">0x0000000000000038</span>, <span class="hljs-number">0x0000000000000028</span>, <span class="hljs-number">0x0000000000000018</span>, <span class="hljs-number">0x0000000000000008</span>, <span class="hljs-number">0x0000000000000037</span>, <span class="hljs-number">0x0000000000000027</span>, <span class="hljs-number">0x0000000000000017</span>, <span class="hljs-number">0x0000000000000007</span>, <span class="hljs-number">0x0000000000000036</span>, <span class="hljs-number">0x0000000000000026</span>, <span class="hljs-number">0x0000000000000016</span>, <span class="hljs-number">0x0000000000000006</span>, <span class="hljs-number">0x0000000000000035</span>, <span class="hljs-number">0x0000000000000025</span>, <span class="hljs-number">0x0000000000000015</span>, <span class="hljs-number">0x0000000000000005</span>, <span class="hljs-number">0x0000000000000034</span>, <span class="hljs-number">0x0000000000000024</span>, <span class="hljs-number">0x0000000000000014</span>, <span class="hljs-number">0x0000000000000004</span>, <span class="hljs-number">0x0000000000000033</span>, <span class="hljs-number">0x0000000000000023</span>, <span class="hljs-number">0x0000000000000013</span>, <span class="hljs-number">0x0000000000000003</span>, <span class="hljs-number">0x0000000000000032</span>, <span class="hljs-number">0x0000000000000022</span>, <span class="hljs-number">0x0000000000000012</span>, <span class="hljs-number">0x0000000000000002</span>, <span class="hljs-number">0x0000000000000031</span>, <span class="hljs-number">0x0000000000000021</span>, <span class="hljs-number">0x0000000000000011</span>, <span class="hljs-number">0x0000000000000001</span>, <span class="hljs-number">0x0000000000000030</span>, <span class="hljs-number">0x0000000000000020</span>, <span class="hljs-number">0x0000000000000010</span>, <span class="hljs-number">0x0000000000000000</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(<span class="hljs-built_in">input</span>)):<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(xorData)-<span class="hljs-number">1</span>):<br>        <span class="hljs-built_in">input</span>[i] ^= xorData[x]<br>        <span class="hljs-built_in">input</span>[i] ^= <span class="hljs-number">0x33</span><br>        <span class="hljs-built_in">input</span>[i] &amp;= <span class="hljs-number">0xffffffffffffffff</span><br>        ta = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">4</span>):<br>            tc = <span class="hljs-built_in">input</span>[i] &gt;&gt; k<br>            tb = tc &amp; <span class="hljs-number">0xf</span><br>            tb = BoxA[tb]<br>            tb = tb &lt;&lt; k<br>            ta += tb<br>        <span class="hljs-built_in">input</span>[i] = ta<br>        ta = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0x40</span>):<br>            tc = <span class="hljs-built_in">input</span>[i] &gt;&gt; k<br>            tb = tc &amp; <span class="hljs-number">0x1</span><br>            td = BoxA[k+<span class="hljs-number">0x10</span>]<br>            ta += tb &lt;&lt; td<br>        <span class="hljs-built_in">input</span>[i] = ta<br>    <span class="hljs-built_in">input</span>[i] ^= <span class="hljs-number">0xcb51f95243105185</span><br>    <span class="hljs-built_in">input</span>[i] ^= <span class="hljs-number">0x33</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">input</span>[i]))<br>    <br></code></pre></td></tr></table></figure>

<p>根据上述写出解密算法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> struct<br>enData = [<span class="hljs-number">0x9C149C0FCE40E599</span>, <span class="hljs-number">0xDF4C680DCD759C04</span>, <span class="hljs-number">0xBBAFB056E52E3DC0</span>, <span class="hljs-number">0x8E299C86B8F527CB</span>]<br>xorData = [<span class="hljs-number">0x696C6F7665696368</span>, <span class="hljs-number">0xCEADD4F8344B7D10</span>, <span class="hljs-number">0xCEBF000259A5B1DB</span>, <span class="hljs-number">0xD1EE63EA2F3AB735</span>, <span class="hljs-number">0xF7EBA4C0BB3AFC6A</span>, <span class="hljs-number">0x0FCB5F041F47B9F6</span>, <span class="hljs-number">0x7BAC2E8CEFDFAE97</span>, <span class="hljs-number">0x2CE86AE8883F2D42</span>, <span class="hljs-number">0x98CDB684B9EEB0A8</span>, <span class="hljs-number">0xC8F10A0794B3A1E3</span>, <span class="hljs-number">0xA89E4C0DEA6336BB</span>, <span class="hljs-number">0xAD4DC0BA7323C479</span>, <span class="hljs-number">0xBA2FC2EC42A27960</span>, <span class="hljs-number">0x52287D00F6B53759</span>, <span class="hljs-number">0x6FC4C7BD96E8BF25</span>, <span class="hljs-number">0x84A63D6C5D48A1C4</span>, <span class="hljs-number">0x3C37F71239BF1354</span>, <span class="hljs-number">0xE4A9BB13CA1298E3</span>, <span class="hljs-number">0xA551883F04F0DFA7</span>, <span class="hljs-number">0x138696DAE392A6B7</span>, <span class="hljs-number">0x1CFCE1EF4E954623</span>, <span class="hljs-number">0xA7EB1762FC4E1A5F</span>, <span class="hljs-number">0x22BFD0AA9873F3DF</span>, <span class="hljs-number">0x19174775129FAC47</span>, <span class="hljs-number">0x1A834072808AFF42</span>, <span class="hljs-number">0x943851D760645D1C</span>, <span class="hljs-number">0x32BD54D0A06A0D46</span>, <span class="hljs-number">0x7AC4490F2250E153</span>, <span class="hljs-number">0xD06535542CCAF560</span>, <span class="hljs-number">0xC414628E29EB1142</span>, <span class="hljs-number">0x01C3F8BAF34194B8</span>, <span class="hljs-number">0xCB51F95243105185</span>]<br>BoxA = [<span class="hljs-number">0x0000000000000002</span>, <span class="hljs-number">0x0000000000000001</span>, <span class="hljs-number">0x0000000000000007</span>, <span class="hljs-number">0x0000000000000004</span>, <span class="hljs-number">0x0000000000000008</span>, <span class="hljs-number">0x000000000000000F</span>, <span class="hljs-number">0x000000000000000E</span>, <span class="hljs-number">0x0000000000000003</span>, <span class="hljs-number">0x000000000000000D</span>, <span class="hljs-number">0x000000000000000A</span>, <span class="hljs-number">0x0000000000000000</span>, <span class="hljs-number">0x0000000000000009</span>, <span class="hljs-number">0x000000000000000B</span>, <span class="hljs-number">0x0000000000000006</span>, <span class="hljs-number">0x0000000000000005</span>, <span class="hljs-number">0x000000000000000C</span>, <span class="hljs-number">0x000000000000003F</span>, <span class="hljs-number">0x000000000000002F</span>, <span class="hljs-number">0x000000000000001F</span>, <span class="hljs-number">0x000000000000000F</span>, <span class="hljs-number">0x000000000000003E</span>, <span class="hljs-number">0x000000000000002E</span>, <span class="hljs-number">0x000000000000001E</span>, <span class="hljs-number">0x000000000000000E</span>, <span class="hljs-number">0x000000000000003D</span>, <span class="hljs-number">0x000000000000002D</span>, <span class="hljs-number">0x000000000000001D</span>, <span class="hljs-number">0x000000000000000D</span>, <span class="hljs-number">0x000000000000003C</span>, <span class="hljs-number">0x000000000000002C</span>, <span class="hljs-number">0x000000000000001C</span>, <span class="hljs-number">0x000000000000000C</span>, <span class="hljs-number">0x000000000000003B</span>, <span class="hljs-number">0x000000000000002B</span>, <span class="hljs-number">0x000000000000001B</span>, <span class="hljs-number">0x000000000000000B</span>, <span class="hljs-number">0x000000000000003A</span>, <span class="hljs-number">0x000000000000002A</span>, <span class="hljs-number">0x000000000000001A</span>, <span class="hljs-number">0x000000000000000A</span>, <span class="hljs-number">0x0000000000000039</span>, <span class="hljs-number">0x0000000000000029</span>, <span class="hljs-number">0x0000000000000019</span>, <span class="hljs-number">0x0000000000000009</span>, <span class="hljs-number">0x0000000000000038</span>, <span class="hljs-number">0x0000000000000028</span>, <span class="hljs-number">0x0000000000000018</span>, <span class="hljs-number">0x0000000000000008</span>, <span class="hljs-number">0x0000000000000037</span>, <span class="hljs-number">0x0000000000000027</span>, <span class="hljs-number">0x0000000000000017</span>, <span class="hljs-number">0x0000000000000007</span>, <span class="hljs-number">0x0000000000000036</span>, <span class="hljs-number">0x0000000000000026</span>, <span class="hljs-number">0x0000000000000016</span>, <span class="hljs-number">0x0000000000000006</span>, <span class="hljs-number">0x0000000000000035</span>, <span class="hljs-number">0x0000000000000025</span>, <span class="hljs-number">0x0000000000000015</span>, <span class="hljs-number">0x0000000000000005</span>, <span class="hljs-number">0x0000000000000034</span>, <span class="hljs-number">0x0000000000000024</span>, <span class="hljs-number">0x0000000000000014</span>, <span class="hljs-number">0x0000000000000004</span>, <span class="hljs-number">0x0000000000000033</span>, <span class="hljs-number">0x0000000000000023</span>, <span class="hljs-number">0x0000000000000013</span>, <span class="hljs-number">0x0000000000000003</span>, <span class="hljs-number">0x0000000000000032</span>, <span class="hljs-number">0x0000000000000022</span>, <span class="hljs-number">0x0000000000000012</span>, <span class="hljs-number">0x0000000000000002</span>, <span class="hljs-number">0x0000000000000031</span>, <span class="hljs-number">0x0000000000000021</span>, <span class="hljs-number">0x0000000000000011</span>, <span class="hljs-number">0x0000000000000001</span>, <span class="hljs-number">0x0000000000000030</span>, <span class="hljs-number">0x0000000000000020</span>, <span class="hljs-number">0x0000000000000010</span>, <span class="hljs-number">0x0000000000000000</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enData)):<br>    enData[i] ^= <span class="hljs-number">0x33</span><br>    enData[i] ^= <span class="hljs-number">0xcb51f95243105185</span><br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(xorData)-<span class="hljs-number">2</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>):<br>        ta = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0x40</span>):<br>            td = BoxA[k+<span class="hljs-number">16</span>]<br>            tc = enData[i] &gt;&gt; td<br>            tb = tc &amp; <span class="hljs-number">0x1</span><br>            ta += tb &lt;&lt; k<br>        enData[i] = ta<br>        ta = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">4</span>):<br>            tc= enData[i] &gt;&gt; k<br>            tb = tc &amp; <span class="hljs-number">0xf</span><br>            tb = BoxA.index(tb)<br>            ta += tb &lt;&lt; k<br>        enData[i] = ta<br>        enData[i] ^= <span class="hljs-number">0x33</span><br>        enData[i] ^= xorData[x]<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(enData[i]))<br>flag = <span class="hljs-string">b&#x27;&#x27;</span>.join(struct.pack(<span class="hljs-string">&quot;&lt;Q&quot;</span>, i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> enData)<br><span class="hljs-built_in">print</span>(flag) <span class="hljs-comment"># a9d99caef9ae999a299129c91299fc95</span><br></code></pre></td></tr></table></figure>

<p>在处理对比数据的时候，还是需要调试情况下去获取，并不是在一个连续的内存空间上</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/CTF/" class="category-chain-item">CTF</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Reverse/" class="print-no-link">#Reverse</a>
      
        <a href="/tags/CTF/" class="print-no-link">#CTF</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>2023年春秋杯冬季赛 RE Writeup</div>
      <div>https://l3isu7e.github.io/2024/01/27/ichunqiu2023/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>L3iSu7e</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年1月27日</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>更新于</div>
          <div>2024年1月27日</div>
        </div>
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/12/30/AnXun2023/" title="2023安洵杯第六届网络安全挑战赛 Re 部分WriteUp">
                        <span class="hidden-mobile">2023安洵杯第六届网络安全挑战赛 Re 部分WriteUp</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <i class="iconfont icon-weibo-fill"></i> <span>大多数图片来源：<a href="https://weibo.com/u/2835750511" target="_blank" rel="nofollow noopener"><span>Linksphotograph</span></a></span> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
